C251 COMPILER V5.60.0,  CONTROL_SYSTEM                                                     25/01/22  13:56:09  PAGE 1   


C251 COMPILER V5.60.0, COMPILATION OF MODULE CONTROL_SYSTEM
OBJECT MODULE PLACED IN .\Objects\CONTROL_SYSTEM.obj
COMPILER INVOKED BY: C:\Keil_v5\C251\BIN\C251.EXE CODE\USER\CONTROL_SYSTEM.c LARGE INTR2 BROWSE INCDIR(.\CODE\ALGORITHM;
                    -.\CODE\DRIVER;.\CODE\Libraries\libraries;.\CODE\Libraries\seekfree_libraries;.\CODE\Libraries\seekfree_peripheral;.\CODE
                    -\USER) DEBUG PRINT(.\Listings\CONTROL_SYSTEM.lst) TABS(2) OBJECT(.\Objects\CONTROL_SYSTEM.obj) 

stmt  level    source

    1          #include "CONTROL_SYSTEM.h"
    2          #include "SERVO_MOTOR_CONTROL.h"
    3          #include "STEP_MOTOR_CONTROL.h"
    4          #include "EM_SENSOR.h"
    5          #include "EM_FILTER.h"
    6          #include "ENCODE_SENSOR.h"
    7          #include "LCD_show.h"
    8          #include "headfile.h"
    9          
   10          #define SPEED 1000
   11          #define AUTO_CONTROL 0
   12          
   13          // MyCAR_STATUS TEMP_STATUS; //临时状态变量
   14          MyCAR_STATUS CUR_STATUS;  //当前状态
   15          int EM_DATA_LIST[4];  //电磁传感器数据存储列表
   16          int TARGET_SPEED;     //目标速度
   17          int CURRENT_SPEED;    //当前速度
   18          int index;            //临时变量
   19          float ANGLE;          //舵机打角
   20          int RES_L;
   21          
   22          EM_FILTER FILTER;        //电磁传感器               
   23          //ENCODE_SENSOR ENCODE_L;  //左轮编码器
   24          
   25          //void (*func_list[7])();//函数指针数组，用于映射不同状态对应的函数
   26          
   27          MyCAR_STATUS CAR_STATUS_JUDGE() {//状态判断
   28   1      
   29   1          return STRAIGHT;
   30   1      }
   31          
   32          void MYSYS_INIT(){
   33   1          //状态函数列表初始化
   34   1          // func_list[0] = FUNC_STRAIGHT;
   35   1          // func_list[1] = FUNC_INTO_CURVE;
   36   1          // func_list[2] = FUNC_ON_CURVE;
   37   1          // func_list[3] = FUNC_OUT_CURVE;
   38   1          // func_list[4] = FUNC_INTO_CIRCLE;
   39   1          // func_list[5] = FUNC_ON_CIRCLE;
   40   1          // func_list[6] = FUNC_OUT_CIRCLE;
   41   1      
   42   1          //FLAG=OFF;
   43   1          
   44   1          EM_INIT_SENSOR();//电磁传感器初始化
   45   1          ENCODING_INIT();//编码器初始化
   46   1          MyStepMotorControl_INIT();      //初始化步进电机控制系统
   47   1          MySteeringControl_INIT();       //初始化舵机
   48   1      }
   49          
   50          void Data_update(){
   51   1          // debug-----------------------------------------------------------------
   52   1          LCD_display("L",EM_DATA_LIST[0],0);
   53   1          LCD_display("LM",EM_DATA_LIST[1],1);
   54   1          LCD_display("RM",EM_DATA_LIST[2],2);
   55   1          LCD_display("R",EM_DATA_LIST[3],3);
   56   1          LCD_display("LV",RES_L,4);
   57   1      //-----------------------------------------------------------------
C251 COMPILER V5.60.0,  CONTROL_SYSTEM                                                     25/01/22  13:56:09  PAGE 2   

   58   1          EM_READ_SENSOR(EM_DATA_LIST);                 //读取数据
   59   1          RES_L = ENCODING_READ_RESULT();//编码器读取电机转速
   60   1      }
   61          
   62          void MyControlSys_TASK() {
   63   1          ANGLE = MySteeringControl_GETANGLE(EM_DATA_LIST, 0);
   64   1          MyStepMotorControl_TASK(RES_L,SPEED);
   65   1          MySteeringControl_TASK(ANGLE);
   66   1          // CUR_STATUS = CAR_STATUS_JUDGE();
   67   1          // (*func_list[CUR_STATUS])();
   68   1      }
   69          
   70          //前进函数
   71          void FORWARD_FUNC(){
   72   1          ANGLE=MySteeringControl_GETANGLE(EM_DATA_LIST,0);
   73   1          CURRENT_SPEED=ENCODING_READ_RESULT();//编码器计算当前速度
   74   1          TARGET_SPEED=SPEED; //min_SPEED + (max_SPEED - min_SPEED)/10*ANGLE;
   75   1          //利用舵机打角角度，处理出速度目标值
   76   1          MyStepMotorControl_TASK(RES_L,TARGET_SPEED);//电机输出
   77   1      }
   78          
   79          //直线行驶状态函数实现
   80          void FUNC_STRAIGHT() {
   81   1          FORWARD_FUNC();
   82   1      }
   83          
   84          //入弯状态函数实现
   85          void FUNC_INTO_CURVE(){
   86   1          MySteeringPIDAdapter_State(ON_TURN);
   87   1          FORWARD_FUNC();
   88   1          CUR_STATUS = ON_CURVE;
   89   1      }
   90          
   91          //在弯道中状态函数实现
   92          void FUNC_ON_CURVE(){
   93   1          FORWARD_FUNC();
   94   1      }
   95          
   96          //出弯状态函数实现
   97          void FUNC_OUT_CURVE(){
   98   1          MySteeringPIDAdapter_State(ON_STRAIGHT);
   99   1          FORWARD_FUNC();
  100   1          CUR_STATUS = STRAIGHT;
  101   1      }
  102          
  103          //入环状态函数实现
  104          void FUNC_INTO_CIRCLE(){
  105   1          MySteeringPIDAdapter_State(ON_TURN);
  106   1          MySteeringControl_TASK(10);
  107   1          delay_ms(1000);
  108   1          CUR_STATUS = ON_CIRCLE;
  109   1      }
  110          
  111          //在环岛中状态函数实现
  112          void FUNC_ON_CIRCLE(){
  113   1          FORWARD_FUNC();
  114   1      }
  115          
  116          //出环状态函数实现
  117          void FUNC_OUT_CIRCLE(){
  118   1          MySteeringPIDAdapter_State(ON_STRAIGHT);
  119   1          FORWARD_FUNC();
  120   1          delay_ms(1000);
  121   1          CUR_STATUS = STRAIGHT;
  122   1      }
  123          
C251 COMPILER V5.60.0,  CONTROL_SYSTEM                                                     25/01/22  13:56:09  PAGE 3   



Module Information          Static   Overlayable
------------------------------------------------
  code size            =       335     ------
  ecode size           =    ------     ------
  data size            =    ------     ------
  idata size           =    ------     ------
  pdata size           =    ------     ------
  xdata size           =        52     ------
  xdata-const size     =    ------     ------
  edata size           =    ------     ------
  bit size             =    ------     ------
  ebit size            =    ------     ------
  bitaddressable size  =    ------     ------
  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =        13     ------
End of Module Information.


C251 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
